<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Galeria 1 - Zonas 11 [28/09/2025, 20:31:09]</title>
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.0/aframe/build/aframe-ar-nft.js"></script>
  <style> 
    body { 
      margin: 0; 
      overflow: hidden; 
      font-family: Arial, sans-serif;
      font-size: 16px;
      background-color: #f5f5f5;
    } 
    
    /* ‚úÖ PAINEL DE CONTROLE DEBUG AVAN√áADO (sempre acess√≠vel) */
    #debug-panel {
      position: fixed;
      top: 10px;
      right: 10px;
      background: linear-gradient(135deg, rgba(0,0,0,0.9) 0%, rgba(30,30,30,0.95) 100%);
      color: white;
      padding: 20px;
      border-radius: 12px;
      font-family: 'Segoe UI', Arial, sans-serif;
      font-size: 13px;
      z-index: 9999;
      display: none;
      min-width: 320px;
      max-width: 400px;
      /* ‚úÖ SCROLLING RESPONS√çVO */
      max-height: calc(100vh - 20px); /* Altura m√°xima baseada na viewport */
      overflow-y: auto; /* Scroll vertical quando necess√°rio */
      overflow-x: hidden; /* Evita scroll horizontal */
      /* Estiliza√ß√£o da barra de scroll */
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,0.3) transparent;
      /* ‚úÖ VISUAL */
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    /* Barra de scroll personalizada para Webkit (Chrome/Safari) */
    #debug-panel::-webkit-scrollbar {
      width: 8px;
    }
    
    #debug-panel::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.05);
      border-radius: 4px;
    }
    
    #debug-panel::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.3);
      border-radius: 4px;
    }
    
    #debug-panel::-webkit-scrollbar-thumb:hover {
      background: rgba(255,255,255,0.5);
    }
    
    #debug-panel.visible {
      display: block;
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    #debug-panel h3 {
      margin: 0 0 15px 0;
      color: #FF6B6B;
      font-size: 16px;
      border-bottom: 2px solid #FF6B6B;
      padding-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .debug-section {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 12px; /* Reduzido para economizar espa√ßo */
      margin-bottom: 12px;
      border-left: 3px solid #4CAF50;
    }
    
    .debug-section h4 {
      margin: 0 0 8px 0;
      color: #87CEEB;
      font-size: 14px;
    }
    
    /* ‚úÖ RESPONSIVIDADE PARA TELAS MENORES */
    @media (max-height: 700px) {
      #debug-panel {
        font-size: 12px;
        padding: 15px;
        min-width: 280px;
        max-width: 320px;
      }
      
      .debug-section {
        padding: 10px;
        margin-bottom: 10px;
      }
      
      .debug-section h4 {
        font-size: 12px;
        margin-bottom: 6px;
      }
      
      #debug-panel h3 {
        font-size: 14px;
        margin-bottom: 10px;
      }
    }
    
    @media (max-height: 600px) {
      #debug-panel {
        font-size: 11px;
        padding: 12px;
        min-width: 260px;
        max-width: 300px;
      }
      
      .debug-section {
        padding: 8px;
        margin-bottom: 8px;
      }
    }
    
    #debug-panel label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px 0 5px 0;
      color: #E0E0E0;
      font-weight: 500;
    }
    
    #debug-panel input[type="range"] {
      width: 100%;
      margin: 8px 0;
      height: 6px;
      border-radius: 3px;
      background: rgba(255,255,255,0.2);
      outline: none;
      cursor: pointer;
    }
    
    #debug-panel input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #4CAF50;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    
    #debug-panel input[type="color"] {
      width: 100%;
      height: 35px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin: 5px 0;
    }
    
    #debug-panel button {
      background: linear-gradient(45deg, #4CAF50, #45a049);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      margin: 5px 5px 0 0;
      font-weight: 600;
      font-size: 12px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
    }
    
    #debug-panel button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
    }
    
    #debug-panel button.save-btn {
      background: linear-gradient(45deg, #FF5722, #E64A19);
      box-shadow: 0 2px 8px rgba(255, 87, 34, 0.3);
    }
    
    #debug-panel button.save-btn:hover {
      box-shadow: 0 4px 12px rgba(255, 87, 34, 0.4);
    }
    
    #debug-panel .value-display {
      color: #FFD700;
      font-weight: bold;
      background: rgba(255, 215, 0, 0.1);
      padding: 2px 8px;
      border-radius: 4px;
      min-width: 50px;
      text-align: center;
    }
    
    .status-indicator {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: #4CAF50;
      color: white;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      z-index: 10000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .status-indicator.show {
      opacity: 1;
    }
    
    .status-indicator.error {
      background: #F44336;
    }
    
    /* ‚úÖ INDICADOR DE CARREGAMENTO */
    #loading-indicator {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #2196F3 0%, #FF5722 100%);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 99999;
      font-family: 'Segoe UI', Arial, sans-serif;
    }
    
    #loading-indicator.hidden {
      display: none;
    }
    
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 10px;
    }
    
    .loading-details {
      font-size: 14px;
      opacity: 0.8;
      text-align: center;
      max-width: 300px;
    }
    #debug-toggle-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #FF5722 0%, #E64A19 100%);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      z-index: 10001;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      font-weight: bold;
      box-shadow: 0 4px 20px rgba(255, 87, 34, 0.4);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255,255,255,0.2);
    }
    
    #debug-toggle-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 25px rgba(255, 87, 34, 0.6);
      background: linear-gradient(135deg, #E64A19 0%, #D84315 100%);
    }
    
    #debug-toggle-btn:active {
      transform: scale(0.95);
    }
    
    /* Anima√ß√£o de pulso quando ativo */
    #debug-toggle-btn.active {
      background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
      animation: debugPulse 2s infinite;
    }
    
    @keyframes debugPulse {
      0% { box-shadow: 0 4px 20px rgba(76, 175, 80, 0.4); }
      50% { box-shadow: 0 4px 20px rgba(76, 175, 80, 0.8), 0 0 0 10px rgba(76, 175, 80, 0.1); }
      100% { box-shadow: 0 4px 20px rgba(76, 175, 80, 0.4); }
    }
    
    /* Tooltip para o bot√£o */
    #debug-toggle-btn::after {
      content: 'Debug Panel';
      position: absolute;
      left: 70px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    
    #debug-toggle-btn:hover::after {
      opacity: 1;
    }
    
    /* ‚úÖ INDICADOR DE SCROLL */
    .scroll-indicator {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.2);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 10px;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }
    
    .scroll-indicator.visible {
      opacity: 1;
    }
    
    /* ‚úÖ BOT√ïES FIXOS NO FINAL */
    .debug-actions {
      position: sticky;
      bottom: 0;
      background: linear-gradient(to top, rgba(30,30,30,0.98) 0%, rgba(30,30,30,0.95) 50%, transparent 100%);
      padding: 15px 0 5px 0;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <!-- ‚úÖ INDICADOR DE CARREGAMENTO -->
  <div id="loading-indicator">
    <div class="loading-spinner"></div>
    <div class="loading-text">Carregando Zonas 11</div>
    <div class="loading-details">Configurando realidade aumentada...</div>
  </div>
  
  <!-- ‚úÖ BOT√ÉO FLUTUANTE PERMANENTE PARA ATIVAR DEBUG -->
  <button id="debug-toggle-btn" title="Ativar/Desativar Debug Panel">
    üîß
  </button>
  
  <!-- ‚úÖ PAINEL DE CONTROLE DEBUG AVAN√áADO -->
  <div id="debug-panel">
    <h3>üîß Configurador Zonas 11 <span style="font-size:12px; opacity:0.7;">- Tempo Real</span></h3>
    
    <!-- Se√ß√£o: Caixas de Colis√£o -->
    <div class="debug-section">
      <h4>üìé Caixas de Colis√£o 3D</h4>
      
      <label>Largura: <span id="width-value" class="value-display">1.0</span></label>
      <input type="range" id="width-slider" min="0.5" max="5.0" step="0.1" value="1.0">
      
      <label>Altura: <span id="height-value" class="value-display">1.0</span></label>
      <input type="range" id="height-slider" min="0.5" max="5.0" step="0.1" value="1.0">
      
      <label>Profundidade: <span id="depth-value" class="value-display">1.0</span></label>
      <input type="range" id="depth-slider" min="0.5" max="5.0" step="0.1" value="1.0">
    </div>
    
    <!-- Se√ß√£o: Configura√ß√µes AR -->
    <div class="debug-section">
      <h4>üì± Realidade Aumentada</h4>
      
      <label>Dist√¢ncia Detec√ß√£o: <span id="detection-value" class="value-display">2m</span></label>
      <input type="range" id="detection-slider" min="1.0" max="10.0" step="0.5" value="2">
      
      <label>Escala Global: <span id="scale-value" class="value-display">1.0x</span></label>
      <input type="range" id="scale-slider" min="0.1" max="3.0" step="0.1" value="1.0">
    </div>
    
    <!-- Se√ß√£o: Interface Visual -->
    <div class="debug-section">
      <h4>üé® Interface Visual</h4>
      
      <label>Cor Prim√°ria:</label>
      <input type="color" id="primary-color" value="#FF5722">
      
      <label>Cor Secund√°ria:</label>
      <input type="color" id="secondary-color" value="#2196F3">
    </div>
    
    <!-- Bot√µes de A√ß√£o - Fixos no Final -->
    <div class="debug-actions">
      <div style="display: flex; flex-wrap: wrap; gap: 8px;">
        <button id="apply-btn">‚úÖ Aplicar</button>
        <button id="save-btn" class="save-btn">üíæ Salvar Config</button>
        <button id="reset-btn">üîÑ Resetar</button>
      </div>
    </div>
    
    <!-- Status e Atalhos -->
    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 11px; color: #999;">
      <div><strong>Ctrl+Shift+5:</strong> Toggle Debug</div>
      <div><strong>ESC:</strong> Fechar Painel</div>
      <div id="config-status" style="margin-top: 6px; color: #4CAF50;">‚úÖ Configura√ß√µes carregadas</div>
    </div>
    
    <!-- Indicador de Scroll -->
    <div class="scroll-indicator" id="scroll-indicator">‚Üì Role para ver mais</div>
  </div>
  
  <!-- Indicador de Status -->
  <div id="status-indicator" class="status-indicator"></div>

  <a-scene embedded arjs="sourceType: webcam;" cursor="rayOrigin: mouse">
    <!-- Container para os marcadores gerados dinamicamente -->
    <a-entity id="markers-container"></a-entity>
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // === CONFIGURA√á√ïES DIN√ÇMICAS DO JSON ===
    const CONFIG_UI = {
      fontePadrao: 'Arial, sans-serif',
      tamanhoFonte: '16px',
      corFundo: '#f5f5f5',
      corPrimaria: '#FF5722',
      corSecundaria: '#2196F3',
      debugModoDebug: 'true' === 'true',
      debugLogsAtivos: 'true' === 'true',
      arTamanhoMarcador: parseFloat('0.6'),
      arDistanciaDeteccao: parseFloat('2')
    };
    
    // Aplica configura√ß√µes CSS dinamicamente
    function aplicarConfiguracoesDinamicas() {
      const body = document.body;
      body.style.fontFamily = CONFIG_UI.fontePadrao;
      body.style.fontSize = CONFIG_UI.tamanhoFonte;
      body.style.backgroundColor = CONFIG_UI.corFundo;
      
      const debugPanel = document.getElementById('debug-panel');
      if (debugPanel && CONFIG_UI.debugModoDebug) {
        debugPanel.style.display = 'block';
      }
      
      if (CONFIG_UI.debugLogsAtivos) {
        console.log('üé® Configura√ß√µes UI aplicadas:', CONFIG_UI);
      }
    }
    
    // Aplica configura√ß√µes quando DOM carregar
    document.addEventListener('DOMContentLoaded', aplicarConfiguracoesDinamicas);
    // === FIM DAS CONFIGURA√á√ïES DIN√ÇMICAS ===
    
    // === PAINEL DE CONTROLE (SUBSTITU√çDO PELO generate.js) ===
    const MARCADORES = [
  {
    "idGaleria": "1",
    "idMarcador": "1",
    "tipoMarcador": "hiro",
    "nomeMarcador": "Mundo J63",
    "modelo3D": "https://rodrigorez.github.io/aulaVRAR/import/models/01.glb",
    "escalaModelo": "1.0",
    "animacaoRotacao": "true",
    "velocidadeRotacao": "1.0",
    "corTema": "#87CEEB",
    "urlMundo": "https://rodrigorez.github.io/aulaVRAR/import/mundos/mundo1_galeria1.html"
  },
  {
    "idGaleria": "1",
    "idMarcador": "2",
    "tipoMarcador": "kanji",
    "nomeMarcador": "Mundo J84",
    "modelo3D": "https://rodrigorez.github.io/aulaVRAR/import/models/02.glb",
    "escalaModelo": "0.8",
    "animacaoRotacao": "true",
    "velocidadeRotacao": "0.5",
    "corTema": "#4B0082",
    "urlMundo": "https://rodrigorez.github.io/aulaVRAR/import/mundos/mundo2_galeria1.html"
  },
  {
    "idGaleria": "1",
    "idMarcador": "3",
    "tipoMarcador": "barcode-5",
    "nomeMarcador": "Mundo J92",
    "modelo3D": "https://rodrigorez.github.io/aulaVRAR/import/models/03.glb",
    "escalaModelo": "1.2",
    "animacaoRotacao": "false",
    "velocidadeRotacao": "0",
    "corTema": "#FF6B6B",
    "urlMundo": "https://rodrigorez.github.io/aulaVRAR/import/mundos/mundo3_galeria1.html"
  }
];

// DEBUG: Sistema de logs para valida√ß√£o
console.log('Sistema Zonas 11 carregado!');
console.log('Total de marcadores:', MARCADORES.length);
MARCADORES.forEach((m, i) => {
  console.log('Marcador ' + (i + 1) + ':', {
    tipo: m.tipoMarcador,
    modelo: m.modelo3D,
    mundo: m.urlMundo
  });
});

// FUN√á√ÉO AUXILIAR: For√ßa navega√ß√£o absoluta
function navegarParaMundo(url) {
  console.log('Navegando para:', url);
  if (url.startsWith('http')) {
    window.location.href = url;
  } else {
    const baseUrl = "https://rodrigorez.github.io/aulaVRAR/import/";
    const finalUrl = baseUrl + url.replace(/^\//, '');
    console.log('URL final gerada:', finalUrl);
    window.location.href = finalUrl;
  }
}
    // === FIM DO PAINEL DE CONTROLE ===

    // ‚úÖ SISTEMA DE DEBUG VISUAL AVAN√áADO (Tempo Real)
    let debugMode = false;
    
    // ‚úÖ CONFIGURA√á√ÉO INICIAL PADR√ÉO (ser√° sobrescrita pelo JSON)
    let currentConfig = {
      // Caixas de colis√£o - VALORES PADR√ÉO (ser√£o carregados do JSON)
      boxWidth: 1.0,
      boxHeight: 1.0,
      boxDepth: 1.0,
      // Configura√ß√µes AR
      detectionDistance: 2.0,
      globalScale: 1.0,
      // Interface
      primaryColor: '#FF5722',
      secondaryColor: '#2196F3'
    };
    
    console.log('üîß Configura√ß√£o inicial (padr√£o):', currentConfig);
    console.log('üì° Carregando valores reais do JSON via API...');
    
    // ‚úÖ FUN√á√ÉO PARA ATUALIZAR STATUS DE CARREGAMENTO
    function updateLoadingStatus(message) {
      const loadingDetails = document.querySelector('.loading-details');
      if (loadingDetails) {
        loadingDetails.textContent = message;
        console.log('üì± Status:', message);
      }
    }
    
    // ‚úÖ FUN√á√ÉO PARA CARREGAR CONFIGURA√á√ÉO DO SERVIDOR IMEDIATAMENTE
    async function loadConfigFromServerSync() {
      try {
        console.log('üîÑ Fazendo requisi√ß√£o para /api/config...');
        const response = await fetch('/api/config');
        const result = await response.json();
        
        if (result.success) {
          const serverConfig = result.config;
          console.log('üì¶ Configura√ß√£o recebida do servidor:', serverConfig);
          
          // ‚úÖ ATUALIZA currentConfig com valores do servidor (JSON)
          currentConfig.boxWidth = serverConfig.configuracaoAR?.tamanhoMarcadorLargura || serverConfig.configuracaoAR?.tamanhoMarcador || 1.0;
          currentConfig.boxHeight = serverConfig.configuracaoAR?.tamanhoMarcadorAltura || serverConfig.configuracaoAR?.tamanhoMarcador || 1.0;
          currentConfig.boxDepth = serverConfig.configuracaoAR?.tamanhoMarcadorProfundidade || serverConfig.configuracaoAR?.tamanhoMarcador || 1.0;
          currentConfig.detectionDistance = serverConfig.configuracaoAR?.distanciaDeteccao || 2.0;
          currentConfig.primaryColor = serverConfig.interface?.corPrimaria || '#FF5722';
          currentConfig.secondaryColor = serverConfig.interface?.corSecundaria || '#2196F3';
          
          console.log('‚úÖ currentConfig atualizada com valores do JSON:', currentConfig);
          console.log('üìè Dimens√µes das caixas:');
          console.log('   - Largura:', currentConfig.boxWidth);
          console.log('   - Altura:', currentConfig.boxHeight);
          console.log('   - Profundidade:', currentConfig.boxDepth);
          
          return true;
        } else {
          console.warn('‚ö†Ô∏è Resposta da API sem sucesso:', result);
          return false;
        }
      } catch (error) {
        console.warn('‚ö†Ô∏è Erro ao carregar config do servidor:', error.message);
        console.warn('üîÑ Usando valores padr√£o');
        return false;
      }
    }
    
    function showStatus(message, type = 'success') {
      const indicator = document.getElementById('status-indicator');
      indicator.textContent = message;
      indicator.className = `status-indicator show ${type}`;
      
      setTimeout(() => {
        indicator.classList.remove('show');
      }, 3000);
    }
    
    function toggleDebugMode() {
      debugMode = !debugMode;
      console.log(`üîß Debug Mode: ${debugMode ? 'ATIVO' : 'INATIVO'}`);
      
      const debugPanel = document.getElementById('debug-panel');
      const toggleBtn = document.getElementById('debug-toggle-btn');
      
      if (debugMode) {
        debugPanel.classList.add('visible');
        toggleBtn.classList.add('active');
        toggleBtn.innerHTML = '‚úÖ'; // Emoji de ativo
        loadCurrentConfig();
        setupScrollIndicator(); // ‚úÖ Configura indicador de scroll
        showStatus('üîß Painel de debug ativado', 'success');
      } else {
        debugPanel.classList.remove('visible');
        toggleBtn.classList.remove('active');
        toggleBtn.innerHTML = 'üîß'; // Emoji de chave
        showStatus('‚ùå Painel de debug desativado', 'success');
      }
      
      // Atualiza todas as caixas de colis√£o
      updateCollisionBoxes();
    }
    
    function loadCurrentConfig() {
      // ‚úÖ CARREGA CONFIGURA√á√ÉO DO SERVIDOR (para uso no painel de debug)
      loadConfigFromServerSync().then((loaded) => {
        if (loaded) {
          // Carrega valores atuais nos controles
          document.getElementById('width-slider').value = currentConfig.boxWidth;
          document.getElementById('height-slider').value = currentConfig.boxHeight;
          document.getElementById('depth-slider').value = currentConfig.boxDepth;
          document.getElementById('detection-slider').value = currentConfig.detectionDistance;
          document.getElementById('scale-slider').value = currentConfig.globalScale;
          document.getElementById('primary-color').value = currentConfig.primaryColor;
          document.getElementById('secondary-color').value = currentConfig.secondaryColor;
          
          // Atualiza displays
          updateDisplayValues();
          
          // Aplica configura√ß√µes nas caixas vis√≠veis
          if (debugMode) {
            updateCollisionBoxes();
          }
          
          console.log('‚úÖ Configura√ß√µes carregadas do servidor para o painel:', currentConfig);
        }
      }).catch(error => {
        console.warn('‚ö†Ô∏è N√£o foi poss√≠vel carregar config do servidor, usando padr√µes');
      });
    }
    
    function updateDisplayValues() {
      document.getElementById('width-value').textContent = currentConfig.boxWidth.toFixed(1);
      document.getElementById('height-value').textContent = currentConfig.boxHeight.toFixed(1);
      document.getElementById('depth-value').textContent = currentConfig.boxDepth.toFixed(1);
      document.getElementById('detection-value').textContent = currentConfig.detectionDistance.toFixed(1) + 'm';
      document.getElementById('scale-value').textContent = currentConfig.globalScale.toFixed(1) + 'x';
    }
    
    // ‚úÖ SISTEMA DE SCROLL INTELIGENTE
    function setupScrollIndicator() {
      const debugPanel = document.getElementById('debug-panel');
      const scrollIndicator = document.getElementById('scroll-indicator');
      
      function checkScroll() {
        const isScrollable = debugPanel.scrollHeight > debugPanel.clientHeight;
        const isAtBottom = debugPanel.scrollTop + debugPanel.clientHeight >= debugPanel.scrollHeight - 5;
        
        if (isScrollable && !isAtBottom) {
          scrollIndicator.classList.add('visible');
        } else {
          scrollIndicator.classList.remove('visible');
        }
      }
      
      // Verifica scroll inicial e em eventos
      setTimeout(checkScroll, 100); // Delay para garantir renderiza√ß√£o
      debugPanel.addEventListener('scroll', checkScroll);
      window.addEventListener('resize', checkScroll);
      
      // Auto-scroll para o topo quando abrir
      debugPanel.scrollTop = 0;
    }
    
    function updateCollisionBoxes() {
      console.log('üîÑ === ATUALIZANDO CAIXAS DE COLIS√ÉO ===');
      console.log('üìä currentConfig no momento da atualiza√ß√£o:', currentConfig);
      
      document.querySelectorAll('.clickable').forEach((box, index) => {
        console.log(`üì¶ Caixa ${index + 1} ANTES da atualiza√ß√£o:`);
        console.log(`   - width atual: ${box.getAttribute('width')}`);
        console.log(`   - height atual: ${box.getAttribute('height')}`);
        console.log(`   - depth atual: ${box.getAttribute('depth')}`);
        
        // Atualiza tamanho usando currentConfig
        box.setAttribute('width', currentConfig.boxWidth);
        box.setAttribute('height', currentConfig.boxHeight);
        box.setAttribute('depth', currentConfig.boxDepth);
        
        console.log(`‚úÖ Caixa ${index + 1} AP√ìS atualiza√ß√£o:`);
        console.log(`   - width: ${box.getAttribute('width')} (aplicado: ${currentConfig.boxWidth})`);
        console.log(`   - height: ${box.getAttribute('height')} (aplicado: ${currentConfig.boxHeight})`);
        console.log(`   - depth: ${box.getAttribute('depth')} (aplicado: ${currentConfig.boxDepth})`);
        
        // Atualiza visibilidade baseada no modo debug
        if (debugMode) {
          box.setAttribute('material', 'color: #FF0000; opacity: 0.5; transparent: true');
          console.log(`   üî¥ Caixa ${index + 1} VIS√çVEL: ${currentConfig.boxWidth}x${currentConfig.boxHeight}x${currentConfig.boxDepth}`);
        } else {
          box.setAttribute('material', 'opacity: 0; transparent: true');
          console.log(`   üëª Caixa ${index + 1} INVIS√çVEL (mas com dimens√µes aplicadas)`);
        }
      });
      
      // Atualiza escala global dos modelos 3D
      document.querySelectorAll('[gltf-model]').forEach((model, index) => {
        const originalScale = parseFloat(model.getAttribute('data-original-scale') || '1.0');
        const newScale = originalScale * currentConfig.globalScale;
        model.setAttribute('scale', `${newScale} ${newScale} ${newScale}`);
        
        if (debugMode) {
          console.log(`   üé≠ Modelo ${index + 1}: Escala ${originalScale} x ${currentConfig.globalScale} = ${newScale}`);
        }
      });
    }
    
    async function saveConfigToJSON() {
      const configData = {
        dominio: "https://rodrigorez.github.io/aulaVRAR/import/",
        ambiente: "production", // Sempre production quando salvo via web
        configuracaoAR: {
          tamanhoMarcador: currentConfig.boxWidth, // Compatibilidade (usa largura)
          tamanhoMarcadorLargura: currentConfig.boxWidth,
          tamanhoMarcadorAltura: currentConfig.boxHeight,
          tamanhoMarcadorProfundidade: currentConfig.boxDepth,
          distanciaDeteccao: currentConfig.detectionDistance,
          qualidadeCamera: "high",
          debugMarcadores: debugMode
        },
        configuracaoVR: {
          fov: 80,
          qualidadeRender: "medium",
          controlesVR: true,
          movimentacao: "teleport"
        },
        interface: {
          corPrimaria: currentConfig.primaryColor,
          corSecundaria: currentConfig.secondaryColor,
          corFundo: "#f5f5f5",
          fontePadrao: "Arial, sans-serif",
          tamanhoFonte: "16px"
        },
        debug: {
          logsAtivos: true,
          modoDebug: debugMode,
          estatisticas: false
        },
        metadados: {
          versaoConfig: "1.0.0",
          ultimaAtualizacao: new Date().toISOString(),
          autor: "Sistema Zonas 11 - Interface Debug Web"
        }
      };
      
      try {
        showStatus('üíæ Salvando configura√ß√£o no servidor...', 'info');
        
        // ‚úÖ SALVA NO SERVIDOR via API
        const response = await fetch('/api/config', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(configData)
        });
        
        const result = await response.json();
        
        if (result.success) {
          console.log('‚úÖ Configura√ß√£o salva no servidor:', result);
          showStatus('‚úÖ Configura√ß√£o salva! Arquivos sendo regenerados...', 'success');
          
          // Atualiza status na interface
          document.getElementById('config-status').innerHTML = `‚úÖ √öltima atualiza√ß√£o: ${new Date().toLocaleString('pt-BR')}`;
          
        } else {
          throw new Error(result.error || 'Erro desconhecido');
        }
        
      } catch (error) {
        console.error('‚ùå Erro ao salvar no servidor:', error);
        
        // Fallback: Download local se servidor n√£o responder
        console.log('üîÑ Tentando fallback para download local...');
        
        const dataStr = JSON.stringify(configData, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = 'config-updated.json';
        link.click();
        
        showStatus('‚ö†Ô∏è Servidor indispon√≠vel - arquivo baixado localmente', 'error');
      }
    }

    function setupDebugControls() {
      // Sliders das caixas de colis√£o
      const widthSlider = document.getElementById('width-slider');
      const heightSlider = document.getElementById('height-slider');
      const depthSlider = document.getElementById('depth-slider');
      const detectionSlider = document.getElementById('detection-slider');
      const scaleSlider = document.getElementById('scale-slider');
      
      // Controles de cor
      const primaryColor = document.getElementById('primary-color');
      const secondaryColor = document.getElementById('secondary-color');
      
      // Bot√µes
      const applyBtn = document.getElementById('apply-btn');
      const saveBtn = document.getElementById('save-btn');
      const resetBtn = document.getElementById('reset-btn');
      
      // ‚úÖ SLIDERS - Atualiza√ß√£o em tempo real
      widthSlider.addEventListener('input', (e) => {
        currentConfig.boxWidth = parseFloat(e.target.value);
        updateDisplayValues();
        updateCollisionBoxes();
      });
      
      heightSlider.addEventListener('input', (e) => {
        currentConfig.boxHeight = parseFloat(e.target.value);
        updateDisplayValues();
        updateCollisionBoxes();
      });
      
      depthSlider.addEventListener('input', (e) => {
        currentConfig.boxDepth = parseFloat(e.target.value);
        updateDisplayValues();
        updateCollisionBoxes();
      });
      
      detectionSlider.addEventListener('input', (e) => {
        currentConfig.detectionDistance = parseFloat(e.target.value);
        updateDisplayValues();
      });
      
      scaleSlider.addEventListener('input', (e) => {
        currentConfig.globalScale = parseFloat(e.target.value);
        updateDisplayValues();
        updateCollisionBoxes();
      });
      
      // ‚úÖ CONTROLES DE COR
      primaryColor.addEventListener('change', (e) => {
        currentConfig.primaryColor = e.target.value;
        document.documentElement.style.setProperty('--primary-color', e.target.value);
      });
      
      secondaryColor.addEventListener('change', (e) => {
        currentConfig.secondaryColor = e.target.value;
        document.documentElement.style.setProperty('--secondary-color', e.target.value);
      });
      
      // ‚úÖ BOT√ïES
      applyBtn.addEventListener('click', () => {
        updateCollisionBoxes();
        showStatus('‚úÖ Configura√ß√µes aplicadas!', 'success');
      });
      
      saveBtn.addEventListener('click', saveConfigToJSON);
      
      resetBtn.addEventListener('click', () => {
        currentConfig = {
          boxWidth: 2.0,
          boxHeight: 2.0,
          boxDepth: 2.0,
          detectionDistance: 2.0,
          globalScale: 1.0,
          primaryColor: '#FF5722',
          secondaryColor: '#2196F3'
        };
        loadCurrentConfig();
        updateCollisionBoxes();
        showStatus('üîÑ Configura√ß√µes resetadas', 'success');
      });
    }
    
    // ‚úÖ EVENTOS: Bot√£o permanente + Atalhos de teclado
    document.addEventListener('DOMContentLoaded', () => {
      // Bot√£o permanente para toggle debug
      const debugToggleBtn = document.getElementById('debug-toggle-btn');
      debugToggleBtn.addEventListener('click', () => {
        console.log('üîß Bot√£o de debug clicado!');
        toggleDebugMode();
      });
      
      console.log('‚úÖ Bot√£o de debug permanente configurado!');
    });
    
    // ‚úÖ ATALHO DE TECLADO: Ctrl+Shift+5 e ESC (ainda funcionam)
    document.addEventListener('keydown', (event) => {
      if (event.ctrlKey && event.shiftKey && event.code === 'Digit5') {
        event.preventDefault();
        toggleDebugMode();
      }
      
      // ESC para fechar painel de debug
      if (event.code === 'Escape' && debugMode) {
        event.preventDefault();
        toggleDebugMode();
      }
    });
    
    // ‚úÖ INICIALIZA CONTROLES
    setupDebugControls();
    
    // ‚úÖ LOG DE INSTRU√á√ÉO (apenas uma vez)
    console.log('üéÆ DEBUG AVAN√áADO: Pressione Ctrl+Shift+5 para mostrar/ocultar painel de configura√ß√£o');

    // ‚úÖ CARREGAMENTO INICIAL - EXECUTA IMEDIATAMENTE
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('üöÄ === INICIANDO CARREGAMENTO DA P√ÅGINA ===');
      
      // ‚úÖ STEP 1: AGUARDA A-FRAME ESTAR COMPLETAMENTE PRONTO
      console.log('üîß STEP 1: Aguardando A-Frame carregar...');
      updateLoadingStatus('Carregando bibliotecas AR/VR...');
      
      // Fun√ß√£o para aguardar A-Frame estar completamente carregado
      function waitForAFrameComplete() {
        return new Promise((resolve) => {
          // Verifica se A-Frame e suas depend√™ncias est√£o carregadas
          function checkAFrame() {
            if (typeof AFRAME !== 'undefined' && 
                AFRAME.components && 
                AFRAME.components['gltf-model'] &&
                AFRAME.components.material &&
                document.querySelector('a-scene')) {
              
              const scene = document.querySelector('a-scene');
              
              // Se a cena j√° est√° carregada
              if (scene.hasLoaded) {
                console.log('‚úÖ A-Frame completamente carregado!');
                resolve();
                return;
              }
              
              // Sen√£o, aguarda o evento 'loaded'
              scene.addEventListener('loaded', () => {
                console.log('‚úÖ A-Frame scene loaded!');
                // Aguarda mais um pouco para garantir estabilidade
                setTimeout(resolve, 200);
              }, { once: true });
              
            } else {
              console.log('‚è≥ Aguardando A-Frame dependencies...');
              setTimeout(checkAFrame, 100);
            }
          }
          
          checkAFrame();
        });
      }
      
      await waitForAFrameComplete();
      
      // ‚úÖ STEP 2: CARREGA CONFIGURA√á√ÉO DO JSON (S√çNCRONO)
      console.log('üì° STEP 2: Carregando configura√ß√£o do JSON...');
      updateLoadingStatus('Carregando configura√ß√µes personalizadas...');
      const configLoaded = await loadConfigFromServerSync();
      
      if (configLoaded) {
        console.log('‚úÖ Configura√ß√£o carregada com sucesso do JSON!');
      } else {
        console.log('‚ö†Ô∏è Usando configura√ß√£o padr√£o');
      }
      
      // ‚úÖ STEP 3: ATUALIZA INTERFACE COM VALORES CARREGADOS
      console.log('üéØ STEP 3: Atualizando interface com valores...');
      updateLoadingStatus('Configurando interface de usu√°rio...');
      updateDisplayValues();
      
      // Atualiza sliders se existirem
      const widthSlider = document.getElementById('width-slider');
      const heightSlider = document.getElementById('height-slider');
      const depthSlider = document.getElementById('depth-slider');
      
      if (widthSlider) widthSlider.value = currentConfig.boxWidth;
      if (heightSlider) heightSlider.value = currentConfig.boxHeight;
      if (depthSlider) depthSlider.value = currentConfig.boxDepth;
      
      // ‚úÖ STEP 4: CRIA MARCADORES COM VALORES CORRETOS
      console.log('üåø STEP 4: Criando marcadores com valores do JSON...');
      updateLoadingStatus('Criando elementos 3D...');
      
      const container = document.querySelector('#markers-container');

      if (typeof MARCADORES === 'undefined' || !Array.isArray(MARCADORES)) {
          console.error("‚ùå Erro: Array MARCADORES n√£o encontrado ou inv√°lido no template.");
          return;
      }

      MARCADORES.forEach((m, index) => {
        const markerEl = document.createElement('a-marker');
        markerEl.setAttribute('id', `marker-${index}`);
        
        // Define o tipo de marcador
        if (['hiro', 'kanji'].includes(m.tipoMarcador)) {
            markerEl.setAttribute('preset', m.tipoMarcador);
        } else if (m.tipoMarcador.startsWith('barcode-')) {
            const value = m.tipoMarcador.split('-')[1];
            markerEl.setAttribute('type', 'barcode');
            markerEl.setAttribute('value', value);
        } else {
            console.warn(`‚ö†Ô∏è Tipo de marcador desconhecido: ${m.tipoMarcador}`);
        }

        // ‚úÖ CONTAINER PRINCIPAL para agrupamento
        const containerEl = document.createElement('a-entity');
        containerEl.setAttribute('id', `container-${index}`);
        
        // ‚úÖ MODELO 3D
        const modelEl = document.createElement('a-entity');
        modelEl.setAttribute('gltf-model', m.modelo3D);
        modelEl.setAttribute('scale', `${m.escalaModelo} ${m.escalaModelo} ${m.escalaModelo}`);
        modelEl.setAttribute('data-original-scale', m.escalaModelo); // Para sistema de escala din√¢mica
        modelEl.setAttribute('id', `model-${index}`);
        
        // ‚úÖ √ÅREA DE CLIQUE INVIS√çVEL (geometria din√¢mica para detec√ß√£o)
        const clickAreaEl = document.createElement('a-box');
        
        console.log(`üéØ Criando caixa de clique ${index + 1}:`);
        console.log(`   - Aplicando width: ${currentConfig.boxWidth}`);
        console.log(`   - Aplicando height: ${currentConfig.boxHeight}`);
        console.log(`   - Aplicando depth: ${currentConfig.boxDepth}`);
        
        clickAreaEl.setAttribute('width', currentConfig.boxWidth);
        clickAreaEl.setAttribute('height', currentConfig.boxHeight);
        clickAreaEl.setAttribute('depth', currentConfig.boxDepth);
        clickAreaEl.setAttribute('material', 'opacity: 0; transparent: true');
        clickAreaEl.setAttribute('class', 'clickable');
        clickAreaEl.setAttribute('id', `clickarea-${index}`);
        
        // ‚úÖ VERIFICA√á√ÉO FINAL ap√≥s setAttribute
        console.log(`‚úÖ Caixa ${index + 1} criada com:`);
        console.log(`   - width final: ${clickAreaEl.getAttribute('width')}`);
        console.log(`   - height final: ${clickAreaEl.getAttribute('height')}`);
        console.log(`   - depth final: ${clickAreaEl.getAttribute('depth')}`);
        
        // ‚úÖ FEEDBACK VISUAL (anel SEMPRE VIS√çVEL - opacidade fixa 80%)
        const feedbackEl = document.createElement('a-ring');
        feedbackEl.setAttribute('radius-inner', '0.6');
        feedbackEl.setAttribute('radius-outer', '1.0');
        feedbackEl.setAttribute('position', '0 0 0.1');
        feedbackEl.setAttribute('material', `color: ${m.corTema || '#00FF00'}; opacity: 0.8`);
        feedbackEl.setAttribute('id', `feedback-${index}`);
        
        // ‚úÖ TEXTO INDICATIVO (sempre vis√≠vel - maior e mais simples)
        const textEl = document.createElement('a-text');
        textEl.setAttribute('value', 'CLIQUE AQUI');
        textEl.setAttribute('position', '0 1.5 0');
        textEl.setAttribute('align', 'center');
        textEl.setAttribute('color', '#FFFFFF');
        textEl.setAttribute('scale', '3 3 3');
        textEl.setAttribute('id', `text-${index}`);
        
        console.log(`üéØ Criando elementos visuais para marcador ${index + 1}:`);
        console.log(`   - Anel: ${m.corTema} com 80% opacidade`);
        console.log(`   - Texto: CLIQUE AQUI (branco, escala 3x)`);
        
        // ‚úÖ ANIMA√á√ÉO DE ROTA√á√ÉO se ativada
        if (m.animacaoRotacao === 'true') {
          const duracao = 5000 / (parseFloat(m.velocidadeRotacao) || 1.0);
          modelEl.setAttribute('animation', `property: rotation; to: 0 360 0; loop: true; dur: ${duracao}; easing: linear`);
        }
        
        // ‚úÖ EVENTO DE CLIQUE simplificado
        clickAreaEl.addEventListener('click', () => {
          console.log(`üî• CLIQUE DETECTADO! Marcador ${index + 1}: ${m.nomeMarcador}`);
          console.log(`üìç Tipo: ${m.tipoMarcador} | Modelo: ${m.modelo3D}`);
          
          // Feedback visual IMEDIATO
          feedbackEl.setAttribute('material', 'color: #FF0000; opacity: 1.0');
          modelEl.setAttribute('scale', '2.0 2.0 2.0');
          textEl.setAttribute('value', 'CONFIRMADO!');
          textEl.setAttribute('color', '#00FF00');
          
          setTimeout(() => {
            console.log(`üöÄ Navegando para: ${m.urlMundo}`);
            navegarParaMundo(m.urlMundo);
          }, 1000);
        });
        
        // ‚úÖ MONTAGEM DA ESTRUTURA com elementos vis√≠veis
        containerEl.appendChild(modelEl);
        containerEl.appendChild(clickAreaEl);
        containerEl.appendChild(feedbackEl);
        containerEl.appendChild(textEl);
        markerEl.appendChild(containerEl);
        container.appendChild(markerEl);
        
        console.log(`‚úÖ Marcador ${index + 1} (${m.nomeMarcador}) - ELEMENTOS CRIADOS:`);
        console.log(`   - Container ID: container-${index}`);
        console.log(`   - Modelo ID: model-${index}`);
        console.log(`   - Clique ID: clickarea-${index}`);
        console.log(`   - Feedback ID: feedback-${index}`);
        console.log(`   - Texto ID: text-${index}`);
        console.log(`   - Cor do tema: ${m.corTema}`);
        console.log(`‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ‚ûñ`);
      });
      
      // ‚úÖ FOR√áA APLICA√á√ÉO IMEDIATA DOS VALORES - GARANTIA ABSOLUTA
      console.log('üöë === FOR√áANDO APLICA√á√ÉO IMEDIATA DOS VALORES ===');
      console.log('üìä currentConfig for√ßado:', currentConfig);
      
      // Aguarda um frame para garantir que elementos foram criados
      requestAnimationFrame(() => {
        const clickableBoxes = document.querySelectorAll('.clickable');
        console.log(`üîç Encontradas ${clickableBoxes.length} caixas clic√°veis`);
        
        clickableBoxes.forEach((box, index) => {
          console.log(`üîß FOR√áANDO valores na caixa ${index + 1}:`);
          console.log(`   - width ANTES: ${box.getAttribute('width')}`);
          console.log(`   - height ANTES: ${box.getAttribute('height')}`);
          console.log(`   - depth ANTES: ${box.getAttribute('depth')}`);
          
          // FOR√áA a aplica√ß√£o dos valores corretos
          box.setAttribute('width', currentConfig.boxWidth);
          box.setAttribute('height', currentConfig.boxHeight);
          box.setAttribute('depth', currentConfig.boxDepth);
          
          console.log(`   - width DEPOIS: ${box.getAttribute('width')} (aplicado: ${currentConfig.boxWidth})`);
          console.log(`   - height DEPOIS: ${box.getAttribute('height')} (aplicado: ${currentConfig.boxHeight})`);
          console.log(`   - depth DEPOIS: ${box.getAttribute('depth')} (aplicado: ${currentConfig.boxDepth})`);
          console.log(`   ‚úÖ Caixa ${index + 1} - VALORES FOR√áADOS APLICADOS`);
        });
        
        console.log('‚úÖ === FOR√áA APLICA√á√ÉO CONCLU√çDA ===');
        
        // ‚úÖ VERIFICA√á√ÉO FINAL - EXIBE ESTADO ATUAL
        setTimeout(() => {
          console.log('üîç === VERIFICA√á√ÉO FINAL DO ESTADO ===');
          document.querySelectorAll('.clickable').forEach((box, index) => {
            console.log(`üìä Caixa ${index + 1} - Estado Final:`);
            console.log(`   - width: ${box.getAttribute('width')}`);
            console.log(`   - height: ${box.getAttribute('height')}`);
            console.log(`   - depth: ${box.getAttribute('depth')}`);
          });
          console.log('‚úÖ === VERIFICA√á√ÉO FINAL CONCLU√çDA ===');
        }, 100);
      });
      
      // ‚úÖ STEP 5: FINALIZA CARREGAMENTO
      console.log('‚úÖ === CARREGAMENTO CONCLU√çDO ===');
      updateLoadingStatus('Finalizando...');
      
      // Esconde indicador de carregamento
      const loadingIndicator = document.getElementById('loading-indicator');
      if (loadingIndicator) {
        setTimeout(() => {
          loadingIndicator.classList.add('hidden');
          console.log('‚úÖ Indicador de carregamento removido');
        }, 500); // Pequeno delay para suavizar a transi√ß√£o
      }
      
      console.log('üéâ P√°gina totalmente carregada e funcionando!');
    });
  </script>
</body>
</html>