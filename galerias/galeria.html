<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Zonas 11 - AR (V2.7)</title>
    <style>
      body { margin: 0; overflow: hidden; }
    </style>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.0/aframe/build/aframe-ar-nft.js"></script>
  </head>
  <body>
    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      vr-mode-ui="enabled: false"
      cursor="rayOrigin: mouse"
      raycaster="objects: .can-click; far: 10000; interval: 100"
    >
      <!-- MARCADOR HIRO: ENTRADA COM OBJETO 3D -->
      <a-marker preset="hiro" id="hiro-marker">
        <a-entity 
          id="interactive-3d"
          gltf-model="https://rodrigorez.github.io/zonas11/galerias/assets/3d/01.glb"
          position="0 0 0"
          scale="0.8 0.8 0.8"
          animation="property: rotation; to: 0 360 0; loop: true; dur: 3000; easing: linear"
        >
          <!-- Caixa de colisão invisível maior para facilitar cliques -->
          <a-box 
            id="collision-box"
            position="0 0 0"
            width="2"
            height="2"
            depth="2"
            opacity="0"
            material="transparent: true"
          ></a-box>
          
          <!-- Indicador visual de clique -->
          <a-ring 
            id="click-indicator"
            position="0 -0.2 0"
            radius-inner="0.4"
            radius-outer="0.5"
            color="#00FF00"
            opacity="0.8"
            animation="property: scale; to: 1.3 1.3 1.3; dur: 1000; easing: easeInOutQuad; loop: true; dir: alternate"
            visible="false"
          ></a-ring>
        </a-entity>
      </a-marker>

      <!-- MARCADOR KANJI: MUNDO -->
      <a-marker preset="kanji" id="kanji-marker">
        <a-entity 
          id="interactive-world"
          gltf-model="https://rodrigorez.github.io/zonas11/galerias/assets/3d/02.glb"
          position="0 0 0"
          scale="0.8 0.8 0.8"
          animation="property: rotation; to: 0 360 0; loop: true; dur: 3000; easing: linear"
        >
          <!-- Caixa de colisão invisível maior para facilitar cliques -->
          <a-box 
            id="collision-box-world"
            position="0 0 0"
            width="2"
            height="2"
            depth="2"
            opacity="0"
            material="transparent: true"
          ></a-box>
          
          <!-- Indicador visual de clique -->
          <a-ring 
            id="click-indicator-world"
            position="0 -0.2 0"
            radius-inner="0.4"
            radius-outer="0.5"
            color="#2196F3"
            opacity="0.8"
            animation="property: scale; to: 1.3 1.3 1.3; dur: 1000; easing: easeInOutQuad; loop: true; dir: alternate"
            visible="false"
          ></a-ring>
        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // Componente simplificado para redirecionamento
      AFRAME.registerComponent('simple-redirect', {
        schema: { url: { type: 'string', default: '#' } },
        init: function () {
          const el = this.el;
          const url = this.data.url;

          el.addEventListener('click', () => {
            console.log('Clique detectado! Redirecionando para:', url);
            window.location.href = url;
          });
        }
      });

      document.addEventListener('DOMContentLoaded', () => {
        const kanjiMarker = document.getElementById('kanji-marker');
        const worldObj = document.getElementById('interactive-world');
        const hiroMarker = document.getElementById('hiro-marker');
        const obj3d = document.getElementById('interactive-3d');

        // Aplicar cor vermelha ao modelo 3D HIRO quando carregado
        if (obj3d) {
          obj3d.addEventListener('model-loaded', () => {
            console.log('Modelo 3D HIRO carregado, aplicando cor vermelha');
            const mesh = obj3d.getObject3D('mesh');
            if (mesh) {
              mesh.traverse((child) => {
                if (child.isMesh && child.material) {
                  if (Array.isArray(child.material)) {
                    child.material.forEach(mat => {
                      mat.color.setHex(0xFF0000);
                    });
                  } else {
                    child.material.color.setHex(0xFF0000);
                  }
                }
              });
            }
          });
        }

        // Aplicar cor azul ao modelo 3D KANJI quando carregado
        if (worldObj) {
          worldObj.addEventListener('model-loaded', () => {
            console.log('Modelo 3D KANJI carregado, aplicando cor azul');
            const mesh = worldObj.getObject3D('mesh');
            if (mesh) {
              mesh.traverse((child) => {
                if (child.isMesh && child.material) {
                  if (Array.isArray(child.material)) {
                    child.material.forEach(mat => {
                      mat.color.setHex(0x2196F3);
                    });
                  } else {
                    child.material.color.setHex(0x2196F3);
                  }
                }
              });
            }
          });
        }

        // Funcionalidade do marcador KANJI (mundo)
        if (kanjiMarker && worldObj) {
          const clickIndicatorWorld = document.getElementById('click-indicator-world');
          const collisionBoxWorld = document.getElementById('collision-box-world');
          
          kanjiMarker.addEventListener('markerFound', () => {
            console.log('Marcador KANJI (mundo) encontrado');
            // Aplicar clique no objeto 3D
            worldObj.classList.add('can-click');
            worldObj.setAttribute('simple-redirect', { url: 'https://rodrigorez.github.io/zonas11/galerias/galeria.html' });
            
            // Aplicar clique na caixa de colisão também
            if (collisionBoxWorld) {
              collisionBoxWorld.classList.add('can-click');
              collisionBoxWorld.setAttribute('simple-redirect', { url: 'https://rodrigorez.github.io/zonas11/galerias/galeria.html' });
            }
            
            // Mostrar indicador visual azul
            if (clickIndicatorWorld) {
              clickIndicatorWorld.setAttribute('visible', 'true');
            }
          });

          kanjiMarker.addEventListener('markerLost', () => {
            console.log('Marcador KANJI (mundo) perdido');
            worldObj.classList.remove('can-click');
            worldObj.removeAttribute('simple-redirect');
            
            if (collisionBoxWorld) {
              collisionBoxWorld.classList.remove('can-click');
              collisionBoxWorld.removeAttribute('simple-redirect');
            }
            
            if (clickIndicatorWorld) {
              clickIndicatorWorld.setAttribute('visible', 'false');
            }
          });
        }

        // Funcionalidade do marcador HIRO
        if (hiroMarker && obj3d) {
          const clickIndicator = document.getElementById('click-indicator');
          const collisionBox = document.getElementById('collision-box');
          
          hiroMarker.addEventListener('markerFound', () => {
            console.log('Marcador HIRO encontrado');
            // Aplicar clique no objeto 3D
            obj3d.classList.add('can-click');
            obj3d.setAttribute('simple-redirect', { url: 'https://rodrigorez.github.io/zonas11/galerias/index2.html' });
            
            // Aplicar clique na caixa de colisão também
            if (collisionBox) {
              collisionBox.classList.add('can-click');
              collisionBox.setAttribute('simple-redirect', { url: 'https://rodrigorez.github.io/zonas11/galerias/index2.html' });
            }
            
            // Mostrar indicador visual
            if (clickIndicator) {
              clickIndicator.setAttribute('visible', 'true');
            }
          });

          hiroMarker.addEventListener('markerLost', () => {
            console.log('Marcador HIRO perdido');
            obj3d.classList.remove('can-click');
            obj3d.removeAttribute('simple-redirect');
            
            if (collisionBox) {
              collisionBox.classList.remove('can-click');
              collisionBox.removeAttribute('simple-redirect');
            }
            
            if (clickIndicator) {
              clickIndicator.setAttribute('visible', 'false');
            }
          });
        }
      });
    </script>
  </body>
</html>