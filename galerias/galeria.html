<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Zonas 11 - AR (V2.7)</title>
    <style>
      body { margin: 0; overflow: hidden; }
    </style>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.0/aframe/build/aframe-ar.js"></script>
    <!--
    =====================================================
    ZONAS 11 - GALERIA PRINCIPAL AR (V2.7)
    =====================================================
    
    DESCRI√á√ÉO:
    - Galeria de Realidade Aumentada principal
    - 4 marcadores barcode (0-3) que ativam 4 mundos VR
    - 28 obras de arte distribu√≠das em 4 mundos (7 cada)
    - Objetos 3D clic√°veis com redirecionamento
    
    ESTRUTURA DOS MUNDOS:
    - Barcode 0 ‚Üí Mundo 0: Obras 1-7  (index2.html)
    - Barcode 1 ‚Üí Mundo 1: Obras 8-14 (index3.html)
    - Barcode 2 ‚Üí Mundo 2: Obras 15-21(index4.html)
    - Barcode 3 ‚Üí Mundo 3: Obras 22-28(index5.html)
    
    FUNCIONALIDADES:
    - Detec√ß√£o de marcadores: AR.js barcode
    - Modelos 3D: .glb com anima√ß√µes rotacionais
    - Indicadores visuais: An√©is vermelhos padronizados
    - Collis√£o: Caixas invis√≠veis para melhor detec√ß√£o
    - Cores: Material vermelho aplicado dinamicamente
    
    INTERA√á√ÉO:
    - Detec√ß√£o de marcador: Ativa objeto 3D clic√°vel
    - Clique no objeto: Redireciona para mundo VR
    - Perda de marcador: Desativa interatividade
    ====================================================
    -->
  </head>
  <body>
    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
      vr-mode-ui="enabled: false"
      cursor="rayOrigin: mouse"
      raycaster="objects: .can-click; far: 10000; interval: 100"
    >
      <!-- MARCADORES BARCODE 0-3: 4 MUNDOS VR -->
      <a-marker type="barcode" value="0" id="barcode-0-marker">
        <a-entity id="interactive-barcode-0" gltf-model="https://rodrigorez.github.io/zonas11/galerias/assets/3d/01.glb" position="0 0 0" scale="0.8 0.8 0.8" animation="property: rotation; to: 0 360 0; loop: true; dur: 4200; easing: easeInOutSine">
          <a-box id="collision-box-barcode-0" position="0 0 0" width="2" height="2" depth="2" opacity="0" material="transparent: true"></a-box>
          <a-ring id="click-indicator-barcode-0" position="0 -0.2 0" radius-inner="0.4" radius-outer="0.5" color="#FF0000" opacity="0.8" animation="property: scale; to: 1.3 1.3 1.3; dur: 1200; easing: easeInOutSine; loop: true; dir: alternate" visible="false"></a-ring>
        </a-entity>
      </a-marker>

      <a-marker type="barcode" value="1" id="barcode-1-marker">
        <a-entity id="interactive-barcode-1" gltf-model="https://rodrigorez.github.io/zonas11/galerias/assets/3d/02.glb" position="0 0 0" scale="0.8 0.8 0.8" animation="property: rotation; to: 0 360 0; loop: true; dur: 3800; easing: easeInOutSine">
          <a-box id="collision-box-barcode-1" position="0 0 0" width="2" height="2" depth="2" opacity="0" material="transparent: true"></a-box>
          <a-ring id="click-indicator-barcode-1" position="0 -0.2 0" radius-inner="0.4" radius-outer="0.5" color="#FF0000" opacity="0.8" animation="property: scale; to: 1.3 1.3 1.3; dur: 1100; easing: easeInOutSine; loop: true; dir: alternate" visible="false"></a-ring>
        </a-entity>
      </a-marker>

      <a-marker type="barcode" value="2" id="barcode-2-marker">
        <a-entity id="interactive-barcode-2" gltf-model="https://rodrigorez.github.io/zonas11/galerias/assets/3d/03.glb" position="0 0 0" scale="0.8 0.8 0.8" animation="property: rotation; to: 0 360 0; loop: true; dur: 4600; easing: easeInOutSine">
          <a-box id="collision-box-barcode-2" position="0 0 0" width="2" height="2" depth="2" opacity="0" material="transparent: true"></a-box>
          <a-ring id="click-indicator-barcode-2" position="0 -0.2 0" radius-inner="0.4" radius-outer="0.5" color="#FF0000" opacity="0.8" animation="property: scale; to: 1.3 1.3 1.3; dur: 1300; easing: easeInOutSine; loop: true; dir: alternate" visible="false"></a-ring>
        </a-entity>
      </a-marker>

      <a-marker type="barcode" value="3" id="barcode-3-marker">
        <a-entity id="interactive-barcode-3" gltf-model="https://rodrigorez.github.io/zonas11/galerias/assets/3d/04.glb" position="0 0 0" scale="0.8 0.8 0.8" animation="property: rotation; to: 0 360 0; loop: true; dur: 3600; easing: easeInOutSine">
          <a-box id="collision-box-barcode-3" position="0 0 0" width="2" height="2" depth="2" opacity="0" material="transparent: true"></a-box>
          <a-ring id="click-indicator-barcode-3" position="0 -0.2 0" radius-inner="0.4" radius-outer="0.5" color="#FF0000" opacity="0.8" animation="property: scale; to: 1.3 1.3 1.3; dur: 1150; easing: easeInOutSine; loop: true; dir: alternate" visible="false"></a-ring>
        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // Componente simplificado para redirecionamento
      AFRAME.registerComponent('simple-redirect', {
        schema: { url: { type: 'string', default: '#' } },
        init: function () {
          const el = this.el;
          const url = this.data.url;

          el.addEventListener('click', () => {
            console.log('Clique detectado! Redirecionando para:', url);
            window.location.href = url;
          });
        }
      });

      document.addEventListener('DOMContentLoaded', () => {
        // Configura√ß√£o: 4 marcadores barcode (0-3) ‚Üí 4 mundos VR com 7 obras cada (total: 28 obras)
        // Mundo 0 (barcode-0): obras 1-7   | Mundo 1 (barcode-1): obras 8-14
        // Mundo 2 (barcode-2): obras 15-21 | Mundo 3 (barcode-3): obras 22-28
        const worldsConfig = {
          'barcode-0-marker': { objId: 'interactive-barcode-0', indicatorId: 'click-indicator-barcode-0', collisionId: 'collision-box-barcode-0', url: 'https://rodrigorez.github.io/zonas11/galerias/index2.html', color: 0xFF0000 },
          'barcode-1-marker': { objId: 'interactive-barcode-1', indicatorId: 'click-indicator-barcode-1', collisionId: 'collision-box-barcode-1', url: 'https://rodrigorez.github.io/zonas11/galerias/index3.html', color: 0xFF0000 },
          'barcode-2-marker': { objId: 'interactive-barcode-2', indicatorId: 'click-indicator-barcode-2', collisionId: 'collision-box-barcode-2', url: 'https://rodrigorez.github.io/zonas11/galerias/index4.html', color: 0xFF0000 },
          'barcode-3-marker': { objId: 'interactive-barcode-3', indicatorId: 'click-indicator-barcode-3', collisionId: 'collision-box-barcode-3', url: 'https://rodrigorez.github.io/zonas11/galerias/index5.html', color: 0xFF0000 }
        };

        // Aguardar inicializa√ß√£o do AR.js
        setTimeout(() => {
          console.log('üöÄ Iniciando configura√ß√£o dos marcadores barcode...');
          
          // Configurar todos os marcadores dinamicamente
          Object.entries(worldsConfig).forEach(([markerId, config]) => {
          console.log(`üîß Configurando marcador: ${markerId}`);
          const marker = document.getElementById(markerId);
          const obj = document.getElementById(config.objId);
          const indicator = document.getElementById(config.indicatorId);
          const collision = document.getElementById(config.collisionId);

          console.log(`üìã Estado dos elementos:`);
          console.log(`  - Marcador: ${marker ? '‚úÖ' : '‚ùå'}`);
          console.log(`  - Objeto 3D: ${obj ? '‚úÖ' : '‚ùå'}`);
          console.log(`  - Indicador: ${indicator ? '‚úÖ' : '‚ùå'}`);
          console.log(`  - Colis√£o: ${collision ? '‚úÖ' : '‚ùå'}`);

          if (marker && obj) {
            // Aplicar cor vermelha ap√≥s carregamento do modelo
            obj.addEventListener('model-loaded', () => {
              console.log(`üî¥ Aplicando cor VERMELHA ao modelo ${config.objId}`);
              
              // Aguardar um frame para garantir que o modelo esteja totalmente carregado
              setTimeout(() => {
                const mesh = obj.getObject3D('mesh');
                console.log(`üß© Procurando mesh no objeto ${config.objId}:`, mesh ? 'ENCONTRADA' : 'N√ÉO ENCONTRADA');
                
                if (mesh) {
                  let materialsCount = 0;
                  mesh.traverse((child) => {
                    if (child.isMesh && child.material) {
                      materialsCount++;
                      console.log(`üé® Aplicando cor ao material ${materialsCount} de ${config.objId}`);
                      
                      // Aplicar cor vermelha diretamente
                      if (Array.isArray(child.material)) {
                        child.material.forEach((mat, index) => {
                          console.log(`  üì¶ Material array [${index}]: aplicando vermelho`);
                          mat.color.setHex(0xFF0000);
                          mat.emissive.setHex(0x220000);
                          mat.needsUpdate = true;
                        });
                      } else {
                        console.log(`  üì¶ Material √∫nico: aplicando vermelho`);
                        child.material.color.setHex(0xFF0000);
                        child.material.emissive.setHex(0x220000);
                        child.material.needsUpdate = true;
                      }
                    }
                  });
                  console.log(`‚úÖ Cor vermelha aplicada em ${materialsCount} materiais de ${config.objId}`);
                } else {
                  console.log(`‚ö†Ô∏è Mesh n√£o encontrada em ${config.objId} - tentando abordagem alternativa`);
                  // Tentar aplicar cor diretamente no objeto
                  obj.setAttribute('material', 'color: #FF0000');
                }
              }, 100);
            });

            // Configurar eventos de marcador
            marker.addEventListener('markerFound', () => {
              console.log(`‚úÖ BARCODE ${markerId.split('-')[1]} DETECTADO!`);
              obj.classList.add('can-click');
              obj.setAttribute('simple-redirect', { url: config.url });
              
              if (collision) {
                collision.classList.add('can-click');
                collision.setAttribute('simple-redirect', { url: config.url });
              }
              
              if (indicator) {
                indicator.setAttribute('visible', 'true');
              }
            });

            marker.addEventListener('markerLost', () => {
              console.log(`‚ùå BARCODE ${markerId.split('-')[1]} perdido`);
              obj.classList.remove('can-click');
              obj.removeAttribute('simple-redirect');
              
              if (collision) {
                collision.classList.remove('can-click');
                collision.removeAttribute('simple-redirect');
              }
              
              if (indicator) {
                indicator.setAttribute('visible', 'false');
              }
            });
          }
        });
        }, 1500); // Delay para garantir inicializa√ß√£o completa
      });
    </script>
  </body>
</html>