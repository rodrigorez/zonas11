<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zonas 11 - VR Mundo 8 (V2.8)</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <!-- Enhanced Controls: Componente modular extens√≠vel -->
    <script src="https://rodrigorez.github.io/zonas11/galerias/assets/js/enhanced-controls.js"></script>
    <!-- Navigation Helper: Sistema dual AR/VR -->
    <script src="https://rodrigorez.github.io/zonas11/galerias/assets/js/navigation-helper.js"></script>
    <style>
      body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
    </style>
    <!--
    =====================================================
    ZONAS 11 - MUNDO VR 8 (OBRAS 49-55)
    =====================================================
    
    DESCRI√á√ÉO:
    - Oitavo mundo VR acess√≠vel via marcador barcode-7
    - Cont√©m 7 obras de arte + 1 esfera de sa√≠da
    - Tema: MATERIALIDADES (√°gua, terra, gesto, fragilidade)
    - Navega√ß√£o: Clique para acessar obras individuais
    - Bot√£o voltar: Retorna para galeria AR/VR principal
    
    ESTRUTURA:
    - Fundo 360¬∞: fundo_mundo08.jpg (ambiente imersivo)
    - 7 Obras: Dispostas em c√≠rculo (45¬∞ entre cada)
    - Esfera voltar: Posi√ß√£o central (0¬∞)
    - Anima√ß√µes: Flutua√ß√£o e oscila√ß√£o org√¢nicas
    - Total: 8 elementos igualmente distribu√≠dos
    
    INTERA√á√ÉO:
    - Clique em obras: Redireciona para p√°gina da obra
    - Clique na esfera: Volta para galeria.html ou galeria-vr.html
    - Navega√ß√£o VR: look-controls + wasd-controls
    ====================================================
    -->
  </head>
  <body>
    <a-scene
      cursor="rayOrigin: mouse"
      vr-mode-ui="enabled: true"
    >
      <!-- üñºÔ∏è FUNDO 360¬∞ -->
      <a-sky src="https://rodrigorez.github.io/zonas11/galerias/assets/img/fundo_mundo08.jpg"></a-sky>

      <!-- üî¥ ESFERA VOLTAR - Posi√ß√£o 1 (0¬∞) -->
      <a-sphere
        class="clickable-back"
        position="0 1.6 -4"
        radius="0.4"
        color="#FF5722"
        animation__float="property: position; to: 0 2.2 -4; dur: 2000; easing: easeInOutSine; loop: true; dir: alternate"
        animation__rotate="property: rotation; to: 0 360 0; dur: 8000; easing: linear; loop: true"
      >
        <a-entity
          position="0 0.6 0"
          text="value: ‚Ü©Ô∏è\nVOLTAR; align: center; color: white; width: 3"
          scale="1.2 1.2 1.2"
        ></a-entity>
      </a-sphere>

      <!-- üñºÔ∏è GALERIA CIRCULAR - 7 OBRAS (45¬∞ entre cada) -->
      
      <!-- Obra 49 - 45¬∞ (Cer√†mica de reg√† lenta) -->
      <a-plane
        class="clickable-image obra49"
        position="2.83 1.6 -2.83"
        width="1.2"
        height="0.8"
        rotation="0 45 0"
        material="src: url(https://rodrigorez.github.io/zonas11/galerias/assets/img/49.jpg); side: double;"
        animation__float="property: position; to: 2.83 2.4 -2.83; dur: 3000; easing: easeInOutSine; loop: true; dir: alternate"
        animation__swing="property: rotation; to: 0 65 5; dur: 4000; easing: easeInOutSine; loop: true; dir: alternate"
      ></a-plane>

      <!-- Obra 50 - 90¬∞ (Perro Creador) -->
      <a-plane
        class="clickable-image obra50"
        position="4 1.6 0"
        width="1.2"
        height="0.8"
        rotation="0 90 0"
        material="src: url(https://rodrigorez.github.io/zonas11/galerias/assets/img/50.jpg); side: double;"
        animation__float="property: position; to: 4 2.3 0; dur: 3200; easing: easeInOutSine; loop: true; dir: alternate"
        animation__swing="property: rotation; to: 5 110 0; dur: 4200; easing: easeInOutSine; loop: true; dir: alternate"
      ></a-plane>

      <!-- Obra 51 - 135¬∞ (Sibilancias reunidas) -->
      <a-plane
        class="clickable-image obra51"
        position="2.83 1.6 2.83"
        width="1.2"
        height="0.8"
        rotation="0 135 0"
        material="src: url(https://rodrigorez.github.io/zonas11/galerias/assets/img/51.jpg); side: double;"
        animation__float="property: position; to: 2.83 2.5 2.83; dur: 2800; easing: easeInOutSine; loop: true; dir: alternate"
        animation__swing="property: rotation; to: -5 155 -5; dur: 3800; easing: easeInOutSine; loop: true; dir: alternate"
      ></a-plane>

      <!-- Obra 52 - 180¬∞ (Domenica a cascina) -->
      <a-plane
        class="clickable-image obra52"
        position="0 1.6 4"
        width="1.2"
        height="0.8"
        rotation="0 180 0"
        material="src: url(https://rodrigorez.github.io/zonas11/galerias/assets/img/52.jpg); side: double;"
        animation__float="property: position; to: 0 2.1 4; dur: 3400; easing: easeInOutSine; loop: true; dir: alternate"
        animation__swing="property: rotation; to: 0 200 5; dur: 4400; easing: easeInOutSine; loop: true; dir: alternate"
      ></a-plane>

      <!-- Obra 53 - 225¬∞ (La poes√≠a segu√≠a existiendo) -->
      <a-plane
        class="clickable-image obra53"
        position="-2.83 1.6 2.83"
        width="1.2"
        height="0.8"
        rotation="0 225 0"
        material="src: url(https://rodrigorez.github.io/zonas11/galerias/assets/img/53.jpg); side: double;"
        animation__float="property: position; to: -2.83 2.6 2.83; dur: 3600; easing: easeInOutSine; loop: true; dir: alternate"
        animation__swing="property: rotation; to: 5 245 0; dur: 3600; easing: easeInOutSine; loop: true; dir: alternate"
      ></a-plane>

      <!-- Obra 54 - 270¬∞ (A nuestro paso) -->
      <a-plane
        class="clickable-image obra54"
        position="-4 1.6 0"
        width="1.2"
        height="0.8"
        rotation="0 270 0"
        material="src: url(https://rodrigorez.github.io/zonas11/galerias/assets/img/54.jpg); side: double;"
        animation__float="property: position; to: -4 2.2 0; dur: 2600; easing: easeInOutSine; loop: true; dir: alternate"
        animation__swing="property: rotation; to: -5 290 -5; dur: 4600; easing: easeInOutSine; loop: true; dir: alternate"
      ></a-plane>

      <!-- Obra 55 - 315¬∞ (T√∫nel) -->
      <a-plane
        class="clickable-image obra55"
        position="-2.83 1.6 -2.83"
        width="1.2"
        height="0.8"
        rotation="0 315 0"
        material="src: url(https://rodrigorez.github.io/zonas11/galerias/assets/img/55.jpg); side: double;"
        animation__float="property: position; to: -2.83 2.4 -2.83; dur: 2400; easing: easeInOutSine; loop: true; dir: alternate"
        animation__swing="property: rotation; to: 0 335 5; dur: 4800; easing: easeInOutSine; loop: true; dir: alternate"
      ></a-plane>

      <!-- üëÅÔ∏è C√¢mera com Enhanced Controls -->
      <a-entity 
        camera 
        look-controls 
        enhanced-controls="rotationSpeed: 45; enableRotation: false; enableMovement: true; moveSpeed: 3; enableMouseDrag: true; mouseDragSpeed: 0.01"
        position="0 1.6 0"
      ></a-entity>
    </a-scene>

    <script>
      AFRAME.registerComponent('redirect-on-click', {
        schema: { url: { type: 'string', default: '#' } },
        init: function () {
          const el = this.el;
          const url = this.data.url;

          el.addEventListener('click', () => {
            el.setAttribute('scale', '1.2 1.2 1.2');
            setTimeout(() => {
              window.location.href = url;
            }, 300);
          });
        }
      });

      document.addEventListener('DOMContentLoaded', () => {
        console.log('üöÄ Mundo 8: Iniciando configura√ß√£o de navega√ß√£o...');
        
        // Verificar se fun√ß√µes do navigation-helper est√£o dispon√≠veis
        if (typeof getNavigationSource === 'undefined') {
          console.error('‚ùå navigation-helper.js N√ÉO foi carregado!');
          return;
        }
        
        // Detectar origem da navega√ß√£o (AR ou VR)
        const source = getNavigationSource(); // Retorna 'ar' ou 'vr'
        console.log(`üåç Mundo 8: Origem detectada ‚Üí ${source.toUpperCase()}`);
        
        // Configurar esfera de voltar DINAMICAMENTE
        const backSphere = document.querySelector('.clickable-back');
        if (backSphere) {
          const galleryURL = getGalleryURL(source);
          backSphere.setAttribute('redirect-on-click', { url: galleryURL });
          console.log(`üîô Bot√£o voltar configurado para: ${galleryURL}`);
        } else {
          console.warn('‚ö†Ô∏è Esfera de voltar N√ÉO encontrada!');
        }

        // Configurar cliques para cada obra COM par√¢metro ?from=
        let obrasConfiguradas = 0;
        for (let i = 49; i <= 55; i++) {
          const obra = document.querySelector(`.obra${i}`);
          if (obra) {
            const obraURL = getObraURL(i, source);
            console.log(`üñºÔ∏è Configurando obra ${i}: ${obraURL}`);
            
            // M√âTODO 1: Via componente A-Frame (padr√£o)
            obra.setAttribute('redirect-on-click', { url: obraURL });
            
            // M√âTODO 2: Via evento JavaScript direto (fallback)
            obra.addEventListener('click', () => {
              console.log(`üñ±Ô∏è Clique direto detectado na obra ${i}!`);
              window.location.href = obraURL;
            });
            
            obrasConfiguradas++;
          } else {
            console.warn(`‚ö†Ô∏è Obra ${i} N√ÉO encontrada no DOM!`);
          }
        }
        
        console.log(`‚úÖ Mundo 8: Navega√ß√£o contextual (${source.toUpperCase()}) configurada`);
        console.log(`üìä ${obrasConfiguradas} obras + 1 esfera = ${obrasConfiguradas + 1} elementos configurados`);
      });
    </script>
  </body>
</html>
